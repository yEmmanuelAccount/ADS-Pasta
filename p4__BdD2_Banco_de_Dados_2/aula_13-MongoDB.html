<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../styles/00-home.css">
    <title>Aula 13: MongoDB</title>
</head>
<body>
    <h1 class="bdd2">MongoDB - 25/11/2025</h1>

    <h2 class="bdd2">Como baixar</h2>
    <p>Na pasta que deseja baixar, rode o comando abaixo para baixar a versão mais recente do MongoDB:</p>
    <pre><code>
        docker run --name mongo -p 27017:27017 -d mongo:latest
    </code></pre>

    <p>Em computadores com o sistema operacional de 32 bits, use o comando abaixo:</p>
    <pre><code>
        docker run --name mongo -p 27017:27017 -d mongo:latest
    </code></pre>

    <h2 class="bdd2">Conectando</h2>
    <p>Execute o comando abaixo:</p>
    <pre><code>
        docker exec -it mongo bash
    </code></pre>

    <p>Confirme a execução com o nome do container:</p>
    <pre><code>mongo</code></pre>

    <h2 class="bdd2">Comandos de Navegação</h2>
    <pre><code>
        show dbs <comment># para mostrar os bancos</comment>
        use aula <comment># vai para o banco 'aula' e se ele não existir é criado</comment>
    </code></pre>

    <h2 class="bdd2">Operações de CRUD</h2>

    <h3 class="bdd2">Insert</h3>
    <p>Existem duas formas de se inserir documentos: <strong>insertOne</strong> e <strong>insertMany</strong>.</p>
    <p>Exemplo 01:</p>
    <pre><code>
        db.tarefas.insertOne ({
            titulo: "Estudar Banco II",
            descricao: "Fazer o projeto da disciplina",
            tipo: "Profissional",
            data: Date("2025-11-25") <comment># padrão americano</comment>
        })
    </code></pre>

    <p>Exemplo 02:</p>
    <pre><code>
        db.textos.insertMany ([
            {texto: "Exemplo 01 de texto1"},
            {texto: "Exemplo 02 de texto2"}
        ])
    </code></pre>

    <p>Inserindo uma turma com um professor e uma lista de alunos:</p>
    <ul>
        <li>Documento dentro de Documento</li>
        <li>Lista de Documentos dentro de um Documento</li>
        <li>Chamado de <strong>agregado de Documentos</strong></li>
    </ul>
    <pre><code>
        db.turma.insertOne ({
            disciplina: "Banco II",
            professor: {nome: "Paulo", titulacao: "Mestre"},
            alunos: [ {nome: "João", matricula: 123}, {nome: "Maria", matricula: 456} ]
        })
    </code></pre>

    <h3 class="bdd2">Exemplos de Buscando um Documento</h3>
    <pre><code>
        db.turma.find().pretty() <comment># equivalente ao 'SELECT * FROM turma'</comment>
        db.turma.find({disciplina: "Banco II"}) <comment># equivalente ao uso do 'WHERE' no 'SELECT * FROM turma'</comment>
    </code></pre>

    <p><strong>Exemplo 01</strong>: retorne o professor da turma onde o nome da disciplina seja "Banco II".</p>
    <pre><code>
        db.turma.find({disciplina: "Banco II"}, {professor: 1}) <comment></comment>
        db.turma.find({disciplina: "Banco II"}, {professor: 1, _id: 0}) <comment># o '_id: 0' é adicionado a uma consulta para retirar a exibição do ID automático do Documento (objeto)</comment>
    </code></pre>

    <p><strong>Exemplo 02</strong>: retorne a disciplina em que o professor é "Paulo".</p>
    <pre><code>
        db.turma.find({"professor.nome": "Paulo"})
    </code></pre>

    <p><strong>Exemplo 03</strong>: retorne as turmas que tenha um aluno com a matrícula maior que 200.</p>
    <pre><code>
        db.turma.find({"alunos.matricula": {$gt: 200}})
    </code></pre>

    <p><strong>Exemplo 04</strong>: retorne as turmas que possuam 2 alunos.</p>
    <pre><code>
        db.turma.find({alunos: {$size: 2}})
    </code></pre>

    <h3 class="bdd2">Update</h3>
    <p>Assim como o Insert, também temos duas formas de Update: <strong>UpdateOne</strong> e <strong>UpdateMany</strong>.</p>

    <p>O <strong>UpdateOne</strong> atualiza apenas o primeiro Documento que for encontrado e que atenda a(s) condição(ões) passada(s).</p>

    <p>Já o <strong>UpdateMany</strong> atualizará todos os Documentos que atenderem ao requisito passado.</p>

    <p>Criando um documento para a exemplificação:</p>
    <pre><code>
        db.produtos.insertMany ([
            {descricao: "Arroz", preco: 4.50},
            {descricao: "Feijão", preco: 8.75},
            {descricao: "Macarrão", preco: 3.80}
        ])
    </code></pre>

    <p><strong>Exemplo 01</strong>: Modifique a descrição do Arroz para "Arroz Parbolizado".</p>
    <pre><code>
        db.produtos.updateOne({descricao: "Arroz"}, {$set: {descricao: "Arroz Parbolizado"}})
    </code></pre>

    <p><strong>Exemplo 02</strong>: Adicione uma tag de promoção aos produtos com valor maior ou igual a 4.</p>
    <pre><code>
        db.produtos.updateMany({preco: {$gte: 4}}, {$set: {tag: "Promocao"}})
    </code></pre>

    <h3 class="bdd2">Exclusão</h3>
    <p>Há duas formas de deletar Documentos: <strong>deleteOne</strong> e <strong>deleteMany</strong>. Em ambos, é passado apenas a condição e dependendo daquele que for usado serão deletados todos os que atenderem o requisito ou o primeiro que atenda ao requisito.</p>

    <p><strong>Exemplo 01</strong>: Exclua os produtos que estão em promoção.</p>
    <pre><code>
        db.produtos.deleteMany({tag: "Promocao"})
    </code></pre>

    <h1 class="bdd2">MongoDB - 26/11/2025</h1>

    <h2 class="bdd2">Startando Container</h2>
    <pre><code>
        docker start mongo <comment># passo 1</comment>
        docker exec -it mongo bash <comment># passo 2</comment>
        mongo <comment># passo 3</comment>
    </code></pre>

    <h2 class="bdd2">Criando Novo Documento para a Aula</h2>
    <pre><code>
        db.usuarios.insertMany ([
            {nome: "João", email: "joao@gmail.com"},
            {nome: "Maria", email: "maria@gmail.com"}
        ])
    </code></pre>

    <h2 class="bdd2">Criação de Index</h2>
    <pre><code>
        db.usuarios.createIndex({email: 1}, {unique: true})
        db.usuarios.getIndexes() <comment># para verificar</comment>
    </code></pre>

    <p>Caso tente a criação de um novo usuário usando um email já cadastrado, o cadastro será negado.</p>
    <pre><code>
        db.usuarios.insertOne({email: "joao@gmail.com"})
    </code></pre>

    <h2 class="bdd2">Relacionando Documento Externo a Usuário</h2>
    <pre><code>
        db.anotacoes.insertOne({
            texto: "Estudar para Banco de Dados II",
            titulo: "Estudar",
            usuarioId: ObjectId('692746d2d415a24fd1c458f6')
        })
    </code></pre>

    <p>Esse tipo de relação não é verificada automaticamente pelo Banco. Por exemplo: uma anotação pode ser relacionada a um <strong>ID de Usuário</strong> que não existe.</p>

    <h2 class="bdd2">Index de Texto</h2>

    <div class="bdd2">Criando Anotações</div>
    <pre><code>
        <comment># anotação 01</comment>
        db.anotacoes.insertOne({
            texto: "João e Maria são alunos de Banco II",
            titulo: "Lista",
            usuarioId: Object('692746d2d415a24fd1c458f6')
        })

        <comment># anotação 02</comment>
        db.anotacoes.insertOne({
            texto: "Maria é uma boa aluna",
            titulo: "Lista",
            usuarioId: Object('692746d2d415a24fd1c458f6')
        })
    </code></pre>

    <p>O <strong>Index de Texto</strong> quebra o texto em <code>Tockens</code>, descarta palavras "inúteis" como "de" e guarda somente os radicais das palavras (descartando gênero das palavras, singular ou plural, etc).</p>

    <div class="bdd2">Criando o Index de Texto</div>
    <pre><code>
        db.anotacoes.createIndex({titulo: "text", conteudo: "text"}, {default_language: "pt", weights: {titulo: 2, conteudo: 1}})
    </code></pre>

    <div class="bdd2">Buscando o Texto</div>
    <pre><code>
        db.anotacoes.find({$text: {$search: "estudo"}})
    </code></pre>

    <h2 class="bdd2">Index GeoEspacial</h2>

    <p>Usaremos dados no formato <strong><a href="http://geojson.io">GeoJSON</a></strong> para salvar informações geoespaciais.</p>
    <div class="bdd2">Criando uma Coleção Espacial:</div>
    <pre><code>
        db.pontos.insertOne({
            localizacao: {
                "coordinates": [
                    -38.54435297888617,
                    -6.889619883144022
                ],
                "type": "Point"
            },
            nome: "IF"
        })
    </code></pre>

    <pre><code>
        db.pontos.insertOne({
            localizacao: {
                "coordinates": [
                    -38.558293113677365,
                    -6.8719807361850656
                ],
                "type": "Point"
            },
            nome: "UFCG"
        })
    </code></pre>

    <pre><code>
        db.pontos.insertOne({
            localizacao: {
                "coordinates": [
                    -38.558173036280095,
                    -6.889879539338395
                ],
                "type": "Point"
            },
            nome: "Teatro ICA"
        })
    </code></pre>

    <div class="bdd2">Criando Index</div>
    <pre><code>
        db.pontos.createIndex({localizacao: "2dsphere"})
    </code></pre>

    <div class="bdd2">Buscando</div>
    <p>Locais cadastrados que estão a 300 metros de distância:</p>
    <pre><code>
        db.pontos.find({
            localizacao: { 
                $near: { $geometry: { "coordinates": [ -38.545193624861895, -6.891366615309096], 
                "type": "Point" }, 
                $maxDistance: 300 } }
        })
    </code></pre>

    <p>Locais cadastrados que estão a 3000 metros (3KM) de distância:</p>
    <pre><code>
        db.pontos.find({
            localizacao: { 
                $near: { $geometry: { "coordinates": [ -38.545193624861895, -6.891366615309096], 
                "type": "Point" }, 
                $maxDistance: 3000 } }
        })
    </code></pre>
</body>
</html>